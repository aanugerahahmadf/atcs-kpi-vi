<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notification System Test</title>
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900">
    <div class="container mx-auto p-8">
        <h1 class="text-3xl font-bold text-center mb-8 text-gray-800 dark:text-white">Notification System Test</h1>

        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">Test Functions</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button onclick="testGetNotificationStyle()" class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                    Test getNotificationStyle()
                </button>
                <button onclick="testFormatDateTime()" class="bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                    Test formatDateTime()
                </button>
                <button onclick="testExtractMessage()" class="bg-purple-500 hover:bg-purple-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                    Test extractMessage()
                </button>
                <button onclick="testShowModal()" class="bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                    Test showModal()
                </button>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">Test Results</h2>
            <div id="results" class="text-gray-700 dark:text-gray-300">
                <p>Click the buttons above to run tests...</p>
            </div>
        </div>
    </div>

    <!-- Notification Detail Modal -->
    <div id="notification-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeNotificationModal()"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 w-full max-w-2xl fade-in relative">
                <button onclick="closeNotificationModal()" class="absolute top-4 right-4 p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200">
                    <i class="bx bx-x text-2xl text-gray-500 dark:text-gray-400"></i>
                </button>

                <div class="flex items-start gap-4 mb-6">
                    <div id="modal-icon-container" class="flex items-center justify-center w-12 h-12 rounded-xl flex-shrink-0">
                        <i id="modal-icon" class="notification-icon text-2xl"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2 mb-1">
                            <span id="modal-type" class="text-sm font-semibold text-gray-800 dark:text-white truncate"></span>
                            <span id="modal-status" class="status-indicator" title="Unread"></span>
                        </div>
                        <div id="modal-created-at" class="text-xs text-gray-600 dark:text-gray-400"></div>
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-2">Notification Details</h3>
                    <div id="modal-message" class="text-gray-700 dark:text-gray-300 break-words"></div>
                </div>

                <div class="mb-6">
                    <h4 class="text-md font-semibold text-gray-800 dark:text-white mb-2">Additional Data</h4>
                    <div id="modal-data" class="text-gray-700 dark:text-gray-300 text-sm break-words"></div>
                </div>

                <div class="flex justify-end gap-2">
                    <button id="delete-notification-btn" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors duration-200">
                        <i class="bx bxs-trash mr-1"></i> Delete
                    </button>
                    <button id="mark-as-read-btn" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors duration-200">
                        <i class="bx bxs-check-circle mr-1"></i> Mark as Read
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Test data
        const testNotification = {
            id: 'test-123',
            type: 'message',
            message: 'This is a test notification message',
            data: {
                sender: 'Test User',
                priority: 'high',
                message: 'This is a test notification message'
            },
            read_at: null,
            created_at: '2025-10-21T10:30:00Z'
        };

        // Function to format date
        function formatDateTime(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleString();
            } catch (e) {
                return dateString;
            }
        }

        // Function to get icon and color based on notification type
        function getNotificationStyle(type) {
            if (!type) return { icon: 'bxs-bell', color: 'blue', bgColor: 'blue-500/20' };

            const typeLower = type.toLowerCase();

            if (typeLower.includes('error') || typeLower.includes('offline')) {
                return { icon: 'bxs-error-circle', color: 'red', bgColor: 'red-500/20' };
            } else if (typeLower.includes('success') || typeLower.includes('online')) {
                return { icon: 'bxs-check-circle', color: 'green', bgColor: 'green-500/20' };
            } else if (typeLower.includes('warning') || typeLower.includes('maintenance')) {
                return { icon: 'bxs-error', color: 'yellow', bgColor: 'yellow-500/20' };
            } else if (typeLower.includes('info') || typeLower.includes('message')) {
                return { icon: 'bxs-info-circle', color: 'blue', bgColor: 'blue-500/20' };
            }

            return { icon: 'bxs-bell', color: 'blue', bgColor: 'blue-500/20' };
        }

        // Function to extract message from notification data
        function extractMessage(notification) {
            // Check if message is directly in the notification
            if (notification.message) {
                return notification.message;
            }

            // Check if message is in the data object
            if (notification.data && typeof notification.data === 'object') {
                if (notification.data.message) {
                    return notification.data.message;
                }

                // If data contains other fields, create a message from them
                const dataKeys = Object.keys(notification.data);
                if (dataKeys.length > 0) {
                    const message = `${dataKeys[0]}: ${notification.data[dataKeys[0]]}`;
                    return message;
                }
            }

            return 'No message available';
        }

        // Function to show notification detail modal
        function showNotificationModal(notification) {
            // Set modal content
            const style = getNotificationStyle(notification.type);

            // Set icon and background
            document.getElementById('modal-icon-container').className = `flex items-center justify-center w-12 h-12 bg-${style.bgColor} rounded-xl flex-shrink-0`;
            document.getElementById('modal-icon').className = `bx ${style.icon} notification-icon text-2xl text-${style.color}-600 dark:text-${style.color}-400`;

            // Set type and status
            document.getElementById('modal-type').textContent = notification.type || 'Notification';
            document.getElementById('modal-status').className = notification.read_at ?
                'status-indicator status-read' :
                'status-indicator status-unread pulse-dot';
            document.getElementById('modal-status').title = notification.read_at ? 'Read' : 'Unread';

            // Set created at
            const formattedDate = notification.created_at ? formatDateTime(notification.created_at) : 'Unknown time';
            document.getElementById('modal-created-at').textContent = formattedDate;

            // Set message
            const message = extractMessage(notification);
            document.getElementById('modal-message').textContent = message;

            // Set additional data
            const dataContainer = document.getElementById('modal-data');
            if (notification.data && typeof notification.data === 'object' && Object.keys(notification.data).length > 0) {
                let dataHtml = '<ul class="space-y-1">';
                for (const [key, value] of Object.entries(notification.data)) {
                    if (key !== 'message') { // Skip message as it's already displayed
                        dataHtml += `<li><strong>${key}:</strong> ${value}</li>`;
                    }
                }
                dataHtml += '</ul>';
                dataContainer.innerHTML = dataHtml;
            } else {
                dataContainer.textContent = 'No additional data available';
            }

            // Set button states
            const deleteBtn = document.getElementById('delete-notification-btn');
            const markAsReadBtn = document.getElementById('mark-as-read-btn');

            if (notification.read_at) {
                markAsReadBtn.innerHTML = '<i class="bx bxs-check-circle mr-1"></i> Mark as Unread';
                markAsReadBtn.onclick = () => markAsUnread(notification.id);
            } else {
                markAsReadBtn.innerHTML = '<i class="bx bxs-check-circle mr-1"></i> Mark as Read';
                markAsReadBtn.onclick = () => markAsRead(notification.id);
            }

            deleteBtn.onclick = () => deleteNotification(notification.id);

            // Show modal
            document.getElementById('notification-modal').classList.remove('hidden');
        }

        // Function to close notification detail modal
        function closeNotificationModal() {
            document.getElementById('notification-modal').classList.add('hidden');
        }

        // Mock functions for testing
        function markAsRead(id) {
            console.log('Marking notification as read:', id);
        }

        function markAsUnread(id) {
            console.log('Marking notification as unread:', id);
        }

        function deleteNotification(id) {
            if (confirm('Are you sure you want to delete this notification?')) {
                console.log('Deleting notification:', id);
                closeNotificationModal();
            }
        }

        // Test functions
        function testGetNotificationStyle() {
            const result = getNotificationStyle('message');
            document.getElementById('results').innerHTML = `
                <h3 class="font-semibold">getNotificationStyle('message') Result:</h3>
                <pre class="bg-gray-100 dark:bg-gray-700 p-2 rounded mt-2">${JSON.stringify(result, null, 2)}</pre>
            `;
        }

        function testFormatDateTime() {
            const result = formatDateTime('2025-10-21T10:30:00Z');
            document.getElementById('results').innerHTML = `
                <h3 class="font-semibold">formatDateTime('2025-10-21T10:30:00Z') Result:</h3>
                <pre class="bg-gray-100 dark:bg-gray-700 p-2 rounded mt-2">${result}</pre>
            `;
        }

        function testExtractMessage() {
            const result = extractMessage(testNotification);
            document.getElementById('results').innerHTML = `
                <h3 class="font-semibold">extractMessage(testNotification) Result:</h3>
                <pre class="bg-gray-100 dark:bg-gray-700 p-2 rounded mt-2">${result}</pre>
            `;
        }

        function testShowModal() {
            showNotificationModal(testNotification);
            document.getElementById('results').innerHTML = `
                <h3 class="font-semibold">showNotificationModal() Called</h3>
                <p class="mt-2">Check if the modal is visible with the test notification data.</p>
            `;
        }
    </script>
</body>
</html>
